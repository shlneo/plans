{% extends 'admin/model/details.html' %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>
                    <i class="fa fa-eye"></i>
                    Просмотр пользователя
                    <small>{{ model }}</small>
                </h1>
                <hr>
                
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-0">
                                    <i class="fa fa-info-circle"></i>
                                    Детальная информация
                                </h5>
                            </div>
                            <div class="col-md-6 text-end">
                                <div class="btn-group">
                                    <a href="{{ url_for('user.edit_view', id=model.id) }}" 
                                       class="btn btn-warning btn-sm">
                                        <i class="fa fa-edit"></i>
                                        Редактировать
                                    </a>
                                    <a href="{{ url_for('user.index_view') }}" 
                                       class="btn btn-secondary btn-sm">
                                        <i class="fa fa-list"></i>
                                        К списку
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        {{ super() }}
                    </div>
                    <div class="card-footer">
                        <small class="text-muted">
                            <i class="fa fa-clock"></i>
                            Последнее обновление: {{ model.last_active.strftime('%d.%m.%Y %H:%M:%S') if model.last_active else 'Неизвестно' }}
                        </small>
                    </div>
                </div>
                
                {% if model.plans %}
                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fa fa-calendar"></i>
                            Планы пользователя ({{ model.plans|length }})
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Название</th>
                                        <th>Статус</th>
                                        <th>Создан</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for plan in model.plans %}
                                    <tr>
                                        <td>{{ plan.id }}</td>
                                        <td>{{ plan.name }}</td>
                                        <td>
                                            {% if plan.is_draft %}
                                                <span class="badge bg-warning">Черновик</span>
                                            {% elif plan.is_approved %}
                                                <span class="badge bg-success">Утвержден</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Неизвестно</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ plan.created_at.strftime('%d.%m.%Y') if plan.created_at else '' }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}